<?xml version='1.0' encoding='utf-8' ?>
<!DOCTYPE article [
<!ENTITY % BOOK_ENTITIES SYSTEM "Release_Notes.ent">
%BOOK_ENTITIES;
<!ENTITY % sgml.features "IGNORE">
<!ENTITY % xml.features "INCLUDE">
<!ENTITY % DOCBOOK_ENTS PUBLIC "-//OASIS//ENTITIES DocBook Character Entities V4.5//EN" "/usr/share/xml/docbook/schema/dtd/4.5/dbcentx.mod">
%DOCBOOK_ENTS;
]>
<article version="5.0" xmlns="http://docbook.org/ns/docbook"
	 xmlns:xlink="http://www.w3.org/1999/xlink"
	 xmlns:xi="http://www.w3.org/2001/XInclude">
  <info xml:id="info-Qlustar_Cluster_OS-Release_Notes-Release_Notes">
    <title>Release Notes</title>
    <subtitle></subtitle>
    <productname>Qlustar Cluster OS</productname>
    <productnumber>10.1</productnumber>
    <edition>1</edition>
    <abstract>
      <para>
	The 10.0 release starts a new era for Qlustar, since it marks the beginning of its
	<classname>100% Open Source</classname> future. It ships version 10.0 of the management
	software QluMan which is absolutely free in any sense now being licensed under the GNU
	Affero public license. The QluMan messaging framework QluNet has been put under the GNU
	Lesser Public license.
      </para>
      <para>
	On the feature side, we introduce <classname>workstation management</classname> as a
	whole new use case for Qlustar. Based on the XFCE desktop environment, you can now
	manage workstations as easy as cluster nodes.
      </para>
      <para>
	The highlight of QluMan 10.0 is a powerful and flexible new network management
	interface. Under the hood, QluMan's messaging framework <classname>QluNet</classname>
	was revamped to use <link
	xlink:href="https://developers.google.com/protocol-buffers/docs/overview/___blank___">Google’s
	Protocol Buffers</link> as the data exchange format for QluMan messages. Protocol
	Buffers are a way of encoding structured data in an efficient yet extensible format and
	provide a strong foundation for QluMan's future.
      </para>
      <para>
	As a result of Q-Leap development on hardware sponsored by Intel, Qlustar 10 introduces
	out-of-the-box support for the OmniPath network technology. All components necessary to
	setup and operate an OmniPath network including the fabric manager are available as
	Qlustar packages.
      </para>
      <para>
	The highlights among the numerous component updates and bug fixes are: Kernel 4.9.x,
	Slurm 17.02.7, CUDA 9.0, BeeGFS 6.18, Lustre 2.10.3 and ZFS 0.7.5.
      </para>
    </abstract>
    <author><orgname><inlinemediaobject><imageobject>
	<imagedata fileref="Common_Content/images/qlustar-logo.png" format="PNG" />
      </imageobject></inlinemediaobject></orgname></author>
  </info>
  <section>
    <title>Basic Info</title>
      <para>
	The Qlustar 10.0 release is based on Ubuntu 16.04.4. It includes all security fixes and
	other package updates published before April 12th 2018. Available security updates
	relevant to Qlustar 10.0, that have appeared after this date, will be announced on the
	Qlustar website and in the Qlustar security newsletter. For now, Ubuntu 16.04 (Xenial)
	is the only <classname>edge platform</classname>, but at least one additional one will
	be added with Qlustar 10.1.
      </para>
  </section>
  <section>
    <title>New features</title>
    <section>
      <title>QluMan 10.0</title>
	<variablelist>
	  <varlistentry>
	    <term>Network management interface</term>
	    <listitem>
	      <para>
		The new QluMan network management interface introduces a flexible way to manage
		the networking aspects of cluster nodes and also nodes outside of the cluster
		(e.g. workstations). It provides a clean abstraction between network
		definitions and their configuration on specific nodes. Check <link
		xlink:href="../QluMan_Guide/index.html#chap-Cluster-Network-Setup___blank___">
		the corresponding section</link> of the QluMan guide to read about the details.
	      </para>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term>QluNet Messaging Framework</term>
	    <listitem>
	      <para>
		QluNet has been largely redesigned to use <link
		xlink:href="https://developers.google.com/protocol-buffers/docs/overview/___blank___">Google’s
		Protocol Buffers</link> as the underlying messaging format. This introduces a
		high degree of type-safety for the components of a message and as a consequence
		leads to improved efficiency and stability. With this change, QluMan's
		messaging stands on firm footing for the future. Along with this redesign, a
		number of additional improvements have been made to enhance QluMan's messaging
		reliability.
	      </para>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term> Miscellaneous</term>
	    <listitem>
	      <para>
		<itemizedlist>
		  <listitem>
		    <para>
		      Global property and config sets have been introduced for a convenient way
		      of adding properties or configurations that should apply to all nodes
		      (<link
		      xlink:href="../QluMan_Guide/index.html#sec-Configuring-Hosts___blank___">more
		      details</link>).
		    </para>
		  </listitem>
		  <listitem>
		    <para>
		      Since Qlustar is free and open-source now, there is no license
		      management/checking anymore. Instead, upon the first start of QluMan,
		      you're required to accept the new licensing terms.
		    </para>
		  </listitem>
		  <listitem>
		    <para>
		      Highly improved checking on the consistency/validity of entered
		      information in the Enclosure View.
		    </para>
		  </listitem>
		</itemizedlist>
	      </para>
	    </listitem>
	  </varlistentry>
	</variablelist>
    </section>
    <section>
      <title>Workstation Management</title>
      <para>
	Qlustar now supports to run workstations like cluster nodes. There are four new Qlustar
	image modules: ws-base, ws-nvidia, ws-xfce and ws-lxde. By defining an image that
	contains the modules ws-base and ws-xfce, adding it to a Boot Config and assigning the
	latter to a group of workstations, you can boot them from the Qlustar head-node and
	provide a unified, nice and clean XFCE desktop experience to your users. While XFCE is
	the default and suggested desktop environment, LXDE can be used as an alternative.
      </para>
    </section>
    <section>
      <title>Support for OmniPath networks</title>
      <para>
	Qlustar now fully supports the <emphasis>OmniPath</emphasis> network technology. The
	Qlustar kernel provides the hardware drivers for the OmniPath adapters and up-to-date
	firmware comes from our linux-firmware package. Our new packages opa-ff and opa-fm
	provide fabric tools and the fabric manager daemon which is required for message
	routing in an OmniPath network. Finally, the psm2 user-space library was packaged to
	allow high-level access to the hardware. Qlustar OpenMPI is built against libpsm2 and
	hence provides out-of-the-box support for OmniPath networks.
      </para>
    </section>
    <section>
      <title>LDAP integration with sssd</title>
      <para>
	The sssd daemon is now used if LDAP integration is required for the cluster. The sssd
	config file <filename>/etc/sssd/sssd.conf</filename> of the head-node is automatically
	imported into generated Qlustar images, if one is found. So all you have to do is
	configure sssd correctly for the head-node, then all other nodes will have a
	functioning configuration as well, provided they can reach the LDAP server specified in
	the sssd configuration file.
      </para>
    </section>
  </section>
  <section>
    <title>Major changes</title>
      <para>
	<variablelist>
	  <varlistentry>
	    <term>Systemd</term>
	    <listitem>
	      <para>
		Along with Ubuntu 16.04, Qlustar 10 has adopted systemd as the boot
		system. Most important services have been ported to systemd. One
		notable change is the use of <link
		xlink:href="https://www.freedesktop.org/wiki/Software/systemd/PredictableNetworkInterfaceNames/___blank___">predictable
		network interface names</link>.
	      </para>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term>Netboot node boot process</term>
	    <listitem>
	      <para>
		The change to systemd also required a rethinking of the boot process for
		netboot nodes. With systemd, it is basically impossible to achieve a clean
		dynamic customization of the node configuration during the boot process after
		systemd has started. Hence, we added a pre-systemd boot phase, where most of
		the dynamic node customization (including disk setup) is taking place. During
		this phase, the QluMan execd of a node is started in a one-shot fashion to
		connect to the head-node and to receive the dynamic node configuration
		options. After this phase, systemd is started and the normal boot process
		commences.
	      </para>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term>SSH keys</term>
	    <listitem>
	      <para>
		For security reasons, Ubuntu 16.04 and hence Qlustar 10 has disabled ssh dsa
		keys. If you still have dsa keys (e.g. for root on the head-node), you need to
		generate a new key (we recommend ed25519 type keys). Don't forget to add the
		new root public key to the <link
		xlink:href="../QluMan_Guide/index.html#sec-SSH-Hosts___blank___">ssh
		authorized-keys config in QluMan</link>, otherwise password-less login to your
		cluster nodes will not work.
	      </para>
	    </listitem>
	  </varlistentry>
	</variablelist>
      </para>
  </section>
  <section>
    <title>Major component updates</title>
      <para>
	<variablelist>
	  <varlistentry>
	    <term>Kernel 4.9</term>
	    <listitem>
	      <para>
		Qlustar 10.0 is based on the 4.9 LTS kernel series. Qlustar kernels include
		full <classname>meltdown/spectre mitigation</classname>. For admins who prefer
		to run without meltdown/spectre mitigation on internal cluster nodes for
		performance reasons, the necessary kernel cmdline options (nopti /
		spectre_v2=off) have been added to the <link
		xlink:href="../QluMan_Guide/index.html#sec-Boot-Configs___blank___">QluMan
		BootConfig dialog</link> for convenient and straightforward inclusion.
	      </para>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term>Slurm</term>
	    <listitem>
	      <para>
		Qlustar 10.0 introduces the Slurm 17.2 series with the current version being
		17.2.7.
	      </para>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term>OFED Infiniband stack</term>
	    <listitem>
	      <para>
		Qlustar 10.0 ships the recently released OFED 4.8-2 Infiniband stack including
		all necessary components.
	      </para>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term>OpenMPI</term>
	    <listitem>
	      <para>
		Qlustar 10.0 upgrades to OpenMPI 2.0.5 including native support for OmniPath.
	      </para>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term>Nvidia CUDA</term>
	    <listitem>
	      <para>
		Qlustar 10.0 provides optimal support for Nvidia GPU hardware by supplying
		pre-compiled and up-to-date kernel drivers as well as CUDA 9.0.
	      </para>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term>BeeGFS</term>
	    <listitem>
	      <para>
		Qlustar 10.0 has integrated the most recent BeeGFS release 6.18 for clients and
		servers with ready-to-use image modules. Furthermore, a new startup mechanism
		has been implemented for clean systemd integration even when using
		multi-target configurations. As a result, ZFS backed BeeGFS deployments on
		Qlustar are extremely simple and robust.
	      </para>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term>Lustre</term>
	    <listitem>
	      <para>
		Qlustar 10.0 ships the most recent Lustre 2.10.3 release for clients and
		servers with ready-to-use image modules. This allows really easy deployment of
		this ultra-fast parallel filesystem backed by ZFS on your storage cluster.
	      </para>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term>ZFS Filesystem</term>
	    <listitem>
	      <para>
		Qlustar 10.0 updates ZFS to version 0.7.5 incorporating a huge number of
		improvements and bug-fixes.
	      </para>
	    </listitem>
	  </varlistentry>
	</variablelist>
      </para>
  </section>
  <section>
    <title>Other notable package version updates</title>
    <para>
      <itemizedlist>
	<listitem>
	  <para>
	    <classname>Intel/PGI Compiler support</classname>: The Qlustar wrapper packages
	    have been updated to support the new versions Intel Parallel Studio 2018 and full
	    support for the PGI community edition 17.10 (package qlustar-pgi-dev-tools).
	    Corresponding OpenMPI package variants for these compilers are also provided.
	  </para>
	</listitem>
	<listitem>
	  <para>
	    <classname>ganglia</classname>: 3.7.2
	  </para>
	</listitem>
	<listitem>
	  <para>
	    <classname>singularity</classname>: 2.4.5
	  </para>
	  <para>
	    Singularity is now installed per default in generated UnionFS chroots and hence
	    available on all Compute-/FrontEnd nodes.
	  </para>
	</listitem>
	<listitem>
	  <para>
	    <classname>hwloc</classname>: 1.11.7
	  </para>
	</listitem>
      </itemizedlist>
    </para>
  </section>
  <section>
    <title>General changes/improvements</title>
      <para>
	<itemizedlist>
	  <listitem>
	    <para>
	      <classname>Node OS image size</classname>: The image size of generated Qlustar
	      node OS images has been substantially reduced by up to 250MB for some combination
	      of image modules.
	    </para>
	  </listitem>
	  <listitem>
	    <para>
	      <classname>Disk-less mode</classname>: For disk-less nodes, additional tmpfs
	      filesystems have been added to make sure that the root RAMdisk doesn't fill up.
	    </para>
	  </listitem>
	  <listitem>
	    <para>
	      <classname>Installer</classname>: Removed torque option. Torque can still be
	      installed manually later on.
	    </para>
	  </listitem>
	</itemizedlist>
      </para>
  </section>
  <section>
    <title>Update instructions</title>
    <task>
      <title></title>
      <procedure>
	<step>
	  <title>Preparations</title>
	  <para>
	    Upgrading to Qlustar 10.0 is only supported from a 9.2.x release.
	  </para>
	  <note><para>
	    Make sure that you have no unwritten changes in the QluMan database. If you do,
	    write them to disk as described in the <link
	    xlink:href="../QluMan_Guide/index.html#sec-Writing-Config-Files___blank___">
	    QluMan Guide</link> before proceeding with the update.
	  </para></note>
	</step>
	<step>
	  <title>Update qluman-common-3</title>
	  <para>
	    <screen>
<prompt>0 root@cl-head ~ #</prompt>
<command>apt-get update</command>
<prompt>0 root@cl-head ~ #</prompt>
<command>apt-get install qluman-common-3</command>
	    </screen>
	  </para>
	</step>
	<step>
	  <title>Update root ssh keys</title>
	  <para>
	    As mentioned above, ssh dsa keys are not usable anymore with Qlustar 10. Hence, if you still rely on a dsa key you need to generate a new one (we suggest ed25519 type):
	    <screen>
<prompt>0 root@cl-head ~ #</prompt>
<command>ssh-keygen -t ed25519 -N ''</command>
	    </screen>
	    Add the content of ~/.ssh/id_ed25519.pub to the <link
	    xlink:href="../QluMan_Guide/index.html#sec-SSH-Hosts___blank___">ssh
	    authorized-keys config in QluMan</link> and remove old dss entries. Then write the
	    ssh config.
	  </para>
	</step>
	<step>
	  <title>Stop execd on nodes</title>
	  <para>
	    Since the QluNet messaging protocol has changed in Qlustar 10, old execds won't be
	    able to connect to the new qluman-router daemon, but will keep trying and hence
	    will overload qluman-router with bogus requests. To prevent this, execd should be
	    stopped on all netboot nodes before upgrading.
	  </para>
	</step>
	<step>
	  <title>Clone chroots</title>
	  <para>
	    It is advisable to clone existing Ubuntu 14.04 chroots (e.g. trusty -> xenial) and
	    then afterwards upgrade the clones to 16.04.
	  </para>
	</step>
	<step>
	  <title>Update to 10.0 package sources list</title>
	  <para>
	    The Qlustar apt sources list needs to be changed as follows both on the
	    head-node(s) and in all chroot(s) that should be updated.
	    <screen>
<prompt>0 root@cl-head ~ #</prompt>
<command>apt-get update</command>
<prompt>0 root@cl-head ~ #</prompt>
<command>apt-get install qlustar-sources-list-10.0</command>
	    </screen>
	  </para>
	</step>
	<step>
	  <title>Update packages</title>
	  <para>
	    Now proceed as explained in the <link
	    xlink:href="../Administration_Manual/index.html#chap-Updating-Qlustar___blank___">
	    Qlustar Administration Manual</link>. However, if the OFED package is installed,
	    you should manually execute the following, before executing <command>apt-get
	    dist-upgrade</command>
	    <screen>
<prompt>0 root@cl-head ~ #</prompt>
<command>apt install ofed</command>
<prompt>0 root@cl-head ~ #</prompt>
<command>dpkg --purge libcxgb4</command>
<prompt>0 root@cl-head ~ #</prompt>
<command>apt-get -f install</command>
	    </screen>
	    Now purge two other packages that will cause trouble if installed.
	    <screen>
<prompt>0 root@cl-head ~ #</prompt>
<command>for p in libcxgb3-1 texlive-latex-recommended-doc; do
  dpkg -l | grep -q $p &amp;&amp; dpkg --purge $p
done</command>
	    </screen>
	    After this the normal update procedure should work fine.
	  </para>
	</step>
	<step>
	  <title>Enable qluman systemd services</title>
	  <para>
	    <screen>
<prompt>0 root@cl-head ~ #</prompt>
<command>for srv in server router slurmd dhcpscanner execd; do \
  systemctl enable qluman-${srv}.service; done</command>
	    </screen>
	  </para>
	</step>
	<step>
	  <title>Enable other necessary systemd services</title>
	  <para>
	    <screen>
<prompt>0 root@cl-head ~ #</prompt>
<command>systemctl enable rpc-statd</command>
	    </screen>
	    If you have a VM FrontEnd node:
	    <screen>
<prompt>0 root@cl-head ~ #</prompt>
<command>systemctl enable qlustar-fe-node-vm</command>
	    </screen>
	  </para>
	</step>
	<step>
	  <title>Fix ganglia/jobmond</title>
	  <para>
	    <screen>
<prompt>0 root@cl-head ~ #</prompt>
<command>apt install libapache2-mod-php7.0 qlustar-ganglia-theme</command>
<prompt>0 root@cl-head ~ #</prompt>
<command>sed -i -e 's|lib/ganglia|lib/x86_64-linux-gnu/ganglia|' \
  /etc/ganglia/gmond.conf</command>
<prompt>0 root@cl-head ~ #</prompt>
<command>rm -f /etc/jobmond.conf</command>
	    </screen>
	  </para>
	</step>
	<step>
	  <title>Reboot head-node(s)</title>
	  <para>
	    Initially only reboot the head-node(s).
	  </para>
	</step>
	<step>
	  <title>Check that MariaDB is running</title>
	  <para>
	    On older installations, it might be necessary to cleanup MariaDB boot scripts. If
	    MariaDB is not running and <filename>/etc/init.d/mysql</filename> is a symbolic
	    link, proceed as follows:
	    <screen>
<prompt>0 root@cl-head ~ #</prompt>
<command>rm -f /etc/init.d/mysql</command>
<prompt>0 root@cl-head ~ #</prompt>
<command>mv /etc/init.d/mysql.dpkg-new /etc/init.d/mysql</command>
	    </screen>
	    Then reboot and check that MariaDB has started automatically.
	  </para>
	</step>
	<step>
	  <title>Regenerating Qlustar images</title>
	  <para>
	    Regenerate your Qlustar images with the 10.0 image modules. To accomplish this,
	    you'll have to select <emphasis>Version 10.0</emphasis> in the QluMan <link
	    xlink:href="../QluMan_Guide/index.html#sec-Qlustar-OS-Images___blank___"> Qlustar
	    Images dialog</link>. If you have new cloned chroots, select those as well.
	  </para>
	</step>
	<step>
	  <title>Write config file changes</title>
	  <para>
	    To activate all changes in the QluMan database that were introduced by the update,
	    they need to be written to disk now. Check the QluMan Guide about <link
	    xlink:href="../QluMan_Guide/index.html#sec-Writing-Config-Files___blank___"> how to
	    write such changes</link>. A number of changes (diffs) in the following configs
	    are expected due to reformatting: DHCP and dsh indentation, NIS hosts,
	    ssh_known_hosts and shosts.equiv, Nagios.
	  </para>
	  <para>
	    Due to the new QluMan networking configuration setup, head-node hosts will be
	    removed from NIS hosts and ssh headers. Also note that the path for
	    <emphasis>CgroupMountpoint</emphasis> in the Slurm <filename>cgroup.conf</filename>
	    has changed to <filename>/sys/fs/cgroup</filename> and the
	    <emphasis>CgroupReleaseAgentDir</emphasis> parameter has become obsolete.
	  </para>
	  <para>
	    If you have netboot nodes with a special network setup, like e.g. a FrontEnd node
	    that has an external interface, you will have to manually add the additional
	    network information as explained <link
	    xlink:href="../QluMan_Guide/index.html#chap-Cluster-Network-Setup___blank___">here</link>. Only
	    the basic networks like the boot and IB as well as IPMI networks are automatically
	    migrated to the new framework.
	  </para>
	</step>
	<step>
	  <title>Reboot all netboot nodes</title>
	  <para>
	    After the regeneration of the images is complete, and all the above steps have been
	    done, you can reboot all other nodes in the cluster, including virtual FE
	    nodes. This completes the update procedure.
	  </para>
	</step>
      </procedure>
    </task>
  </section>
  <section>
    <title>Changelogs</title>
    <para>
      A detailed log of changes in the image modules can be found in the directories
      <filename>/usr/share/doc/qlustar-module-&#60;module-name&#62;-*-amd64-10.0.0</filename>.
      As an example, in the directory
      <filename>/usr/share/doc/qlustar-module-core-xenial-amd64-10.0.0</filename> you will
      find a summary changelog in <filename>core.changelog</filename>, a complete list of
      packages with version numbers entering the current core module in
      <filename>core.packages.version.gz</filename>, a complete changelog of the core modules
      package versions in <filename>core.packages.version.gz</filename> and finally a complete
      log of changed files in <filename>core.contents.changelog.gz</filename>.
      </para>
      </section>
</article>

